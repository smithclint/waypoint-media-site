<!doctype html>
<html>
  <head>
    <title>Portfolio Debug</title>
  </head>
  <body>
    <h1>Portfolio Loading Debug</h1>
    <div id="debug-output"></div>
    <div id="portfolio-data"></div>

    <script>
      const debugDiv = document.getElementById('debug-output');
      const portfolioDiv = document.getElementById('portfolio-data');

      function log(message) {
        console.log(message);
        debugDiv.innerHTML += '<p>' + message + '</p>';
      }

      async function loadPhotoData() {
        try {
          log('üîÑ Loading photos.json...');
          const response = await fetch('photos.json');
          if (response.ok) {
            const shootMetadata = await response.json();
            log('‚úÖ Loaded photos.json with ' + Object.keys(shootMetadata).length + ' shoots');

            // Show raw data
            portfolioDiv.innerHTML =
              '<h2>Raw photos.json data:</h2><pre>' +
              JSON.stringify(shootMetadata, null, 2) +
              '</pre>';

            const portfolioData = await loadPhotosFromReleases(shootMetadata);
            log('‚úÖ Finished loading from releases');

            // Show processed data
            portfolioDiv.innerHTML +=
              '<h2>Processed portfolio data:</h2><pre>' +
              JSON.stringify(portfolioData, null, 2) +
              '</pre>';
          } else {
            log('‚ùå Could not load photos.json: ' + response.status);
          }
        } catch (error) {
          log('‚ùå Error loading photos.json: ' + error.message);
        }
      }

      async function loadPhotosFromReleases(shootMetadata) {
        const enrichedData = {};

        for (const [shootId, metadata] of Object.entries(shootMetadata)) {
          log('üîÑ Processing ' + shootId + '...');
          enrichedData[shootId] = { ...metadata };

          if (metadata.release_tag) {
            try {
              const releaseUrl = `https://api.github.com/repos/smithclint/waypoint-media-site/releases/tags/${metadata.release_tag}`;
              log('üì° Fetching: ' + releaseUrl);

              const releaseResponse = await fetch(releaseUrl);
              if (releaseResponse.ok) {
                const releaseData = await releaseResponse.json();
                const images = releaseData.assets
                  .filter(asset => asset.name.match(/\.(jpg|jpeg|png|webp)$/i))
                  .map(asset => ({
                    url: asset.browser_download_url,
                  }));

                enrichedData[shootId].images = images;
                log(`‚úÖ Loaded ${images.length} photos for ${shootId}`);
              } else {
                log(`‚ùå GitHub API error for ${shootId}: ${releaseResponse.status}`);
                enrichedData[shootId].images = metadata.images || [];
              }
            } catch (error) {
              log(`‚ùå Error loading ${shootId}: ${error.message}`);
              enrichedData[shootId].images = metadata.images || [];
            }
          } else {
            enrichedData[shootId].images = metadata.images || [];
            log(`üìÑ Using static images for ${shootId}: ${(metadata.images || []).length} images`);
          }
        }

        return enrichedData;
      }

      // Start the debug process
      document.addEventListener('DOMContentLoaded', loadPhotoData);
    </script>
  </body>
</html>
